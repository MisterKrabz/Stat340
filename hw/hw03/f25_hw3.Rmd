---
title: "Homework 3"
author: "Your Name Here"
output: 
  html_document:
    self_contained: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=T,eval=T,message=F,warning=F,fig.align='center')
library(tidyverse)
```


## 1. Random Geometry <small>(2pts each, 8pts total)</small>
Use Monte Carlo simulation to estimate the following geometric properties of shapes and solids. Use the following facts:

* The distance between $(x_1,y_1)$ and $(x_2,y_2)$ is $\sqrt{(x_2-x_1)^2+(y_2-y_1)^2}$
* The coordinates of a point on a unit circle at angle $\theta$ is $(\cos\theta,\sin\theta)$
* The area of a triangle with vertices $(x_i, y_i), i=1,2,3$ is $\frac12 \left|x_1(y_2 − y_3) + x_2(y_3 − y_1) + x_3(y_1 − y_2)\right|$

a. What is the the average distance between two uniformly random points in a box with side lengths 4, 6 and 10?
```{r}
reps <- 1:10000000

L <- 4
W <- 6
H <- 10

p1_x <- runif(n = reps, min = 0, max = L)
p1_y <- runif(n = reps, min = 0, max = W)
p1_z <- runif(n = reps, min = 0, max = H)

p2_x <- runif(n = reps, min = 0, max = L)
p2_y <- runif(n = reps, min = 0, max = W)
p2_z <- runif(n = reps, min = 0, max = H)

dx <- (p1_x - p2_x)^2
dy <- (p1_y - p2_y)^2
dz <- (p1_z - p2_z)^2

distances <- sqrt(dx + dy + dz)

mean(distances)
```
> 4.598

b. Three points uniformly at random are selected on a circle with radius 1. What is the average area of the triangle formed?
```{r}
n_reps <- 10000000

R <- 1

x_raw1 <- rnorm(n = n_reps, mean = 0, sd = 1)
y_raw1 <- rnorm(n = n_reps, mean = 0, sd = 1)

mag1 <- sqrt(x_raw1^2 + y_raw1^2)

x1 <- R * x_raw1 / mag1
y1 <- R * y_raw1 / mag1

x_raw2 <- rnorm(n = n_reps, mean = 0, sd = 1)
y_raw2 <- rnorm(n = n_reps, mean = 0, sd = 1)
mag2 <- sqrt(x_raw2^2 + y_raw2^2)
x2 <- R * x_raw2 / mag2
y2 <- R * y_raw2 / mag2

x_raw3 <- rnorm(n = n_reps, mean = 0, sd = 1)
y_raw3 <- rnorm(n = n_reps, mean = 0, sd = 1)
mag3 <- sqrt(x_raw3^2 + y_raw3^2)
x3 <- R * x_raw3 / mag3
y3 <- R * y_raw3 / mag3

base_length <- sqrt((x1 - x2)^2 + (y1 - y2)^2)

height_numerator <- abs((x2 - x1) * (y1 - y3) - (x1 - x3) * (y2 - y1))
height <- height_numerator / base_length

height[is.nan(height)] <- 0

areas <- 0.5 * base_length * height

mean(areas)
```
> .478

b. Three points uniformly at random are selected on a circle with radius 1. What is the expected perimeter of the triangle formed?
```{r}
n_reps <- 10000000

R <- 1

x_raw1 <- rnorm(n = n_reps, mean = 0, sd = 1)
y_raw1 <- rnorm(n = n_reps, mean = 0, sd = 1)

mag1 <- sqrt(x_raw1^2 + y_raw1^2)

x1 <- R * x_raw1 / mag1
y1 <- R * y_raw1 / mag1

x_raw2 <- rnorm(n = n_reps, mean = 0, sd = 1)
y_raw2 <- rnorm(n = n_reps, mean = 0, sd = 1)
mag2 <- sqrt(x_raw2^2 + y_raw2^2)
x2 <- R * x_raw2 / mag2
y2 <- R * y_raw2 / mag2

x_raw3 <- rnorm(n = n_reps, mean = 0, sd = 1)
y_raw3 <- rnorm(n = n_reps, mean = 0, sd = 1)
mag3 <- sqrt(x_raw3^2 + y_raw3^2)
x3 <- R * x_raw3 / mag3
y3 <- R * y_raw3 / mag3

side12 <- sqrt((x1 - x2)^2 + (y1 - y2)^2)
side23 <- sqrt((x2 - x3)^2 + (y2 - y3)^2)
side31 <- sqrt((x3 - x1)^2 + (y3 - y1)^2)

perimeters <- side12 + side23 + side31

mean(perimeters)
```
> 3.820

d. What is the average distance on a disc of radius 1 to its center? (hint: One way to get points uniformly distributed over a circle is to pick points from a square and if they are not in the circle just pick again).
```{r}
n_reps <- 10000000

# Generate points in a bounding square and reject those outside the circle.
# The area of the circle is pi, the area of the square is 4. The acceptance
# rate is pi/4 (~78.5%), so we need to generate more points than n_reps.
# We will generate n_reps / (pi/4) to be safe.
n_generate <- as.integer(n_reps * 4 / pi)

x_square <- runif(n = n_generate, min = -1, max = 1)
y_square <- runif(n = n_generate, min = -1, max = 1)

# Keep only the points that fall within the disc (x^2 + y^2 <= 1)
dist_sq_from_center <- x_square^2 + y_square^2
points_inside <- dist_sq_from_center[dist_sq_from_center <= 1]

# Trim down to the desired number of points, just in case we have extra
points_inside <- points_inside[1:n_reps]

# The distance is the square root of the squared distance
distances <- sqrt(points_inside)

mean(distances)
```
> .667


## 2. Law of Large Numbers  <small>(2pts each, 10pts total)</small>

For this next problem, we're going to empirically demonstrate the law of large numbers by simulating $N$ observations of a random variable, and show the convergence of the sample mean to the theoretical mean. Consider a Poisson variable $X$ with $\lambda=13$. It should hopefully be clear from the definition of the Poisson that $E(X)=\lambda=13$.

a. Start by creating a data frame with 2 columns: a column named `n` that goes from 1, 2, ..., up to 1000; and a second column named `x` which is just 1000 repeated observations of a Poisson random variable with `lambda=13`.
b. Next, create a third column named `xbar` that computes the "mean-thus-far" up to each row. E.g. if the first 3 values of `x` are 3, 1, 8, then the first 3 values of `xbar` should be 3, 2, 4, since 3=3, (3+1)/2=2, and (3+1+8)/3=4.
   (Hint: use the `cumsum()` function to take the cumulative sum of the `x` column, then divide by the number of observations so far)
c. Make a line plot showing xbar vs n. Add a red line at the theoretical mean. Comment on what you observe in the plot. Is this what you were expecting? (Don't forget to add proper labels/titles).
d. Now, increase the number of simulations to 100,000 and remake the plot, this time with a log-scale x-axis to better show the rate of convergence across the entire axis. Comment again on the output. Explain if this does or does not empirically agree with the law of large numbers.
e. Repeat the above steps with a **different** random variable. You can copy your entire code chunk so far and just make the necessary modifications. Comment on this output too and whether or not it also agrees with your expectations. Make sure you CLEARLY define what the random variable you're using and clearly state what the expected value is (you may look this up on the internet if it's a new random variable we covered this week that we did not give the expectation formula for in class).





## 3. Estimating $E(g(X))$  <small>(2pts each, 6pts total)</small>

Let $X$ be a normally distributed random variable, $X\sim N(2, 1^2)$. Use Monte Carlo simulation to estimate the following:

a. $E(X^3)$

b. $E(\sin(X))$

c. $E(e^X)$




## 4. How Many Billies Can Fit? <small>(2pts each, 10pts total)</small>

You have an empty wall That is exactly 242 cm wide (with walls on either side). You see that Billy the Bookcase (https://www.ikea.com/us/en/p/billy-bookcase-white-00263850/) is 80cm wide, so you should be able to fit 3 in this space.

Suppose, however that The width of Billy is actually 80cm **on average**. In fact, the width is a normal random variable with a mean of 80 and a standard deviation of .9cm. (Please note - this is fictional! Ikea would never let quality control slip this bad). Use Monte Carlo simulation to answer the following questions:

a. Estimate the expected value and standard deviation for the **total width** of the 3 Billys.
b. If you buy 3 Billys, what is the probability that they will fit in the space? Assume Billys are independent.
c. How wide of a space would you need to be 99% sure that 3 Billys would fit? *Hint: Use the `quantile` function in R*
d. There are two other bookcases made by knockoff brand "Iqueeya": Goat and Gruff. Goat bookcase widths are normally distributed with a mean of 79cm and a standard deviation of .5cm, while Gruff bookcase widths are normally distributed with a mean of 81cm and a standard deviation of .5cm. What is the probability that a Billy, a Goat and a Gruff will fit on your wall? (Assume independence)
e. Suppose you want the amount of gap between the bookcases and the side walls to be **as small as possible**. You assess how good of a fit you have by scoring: Buying 3 bookcases gives you a score of 0 if they don't fit, but otherwise a score of $$\frac{\text{total width}}{242}\times 100.$$ What combination of Billys, Goats and Gruffs gives you the highest *expected score*?

```{r, echo=FALSE}
# The scoring function is provided for you. 
# You can feed it a single width or a vector of widths
score <- function(width){
  scores <- rep(0, length(width))
  scores[width<=242] <- width[width<=242]/242*100 
  return(mean(scores))
}
```





## 5. Integration by darts <small>(2pts each, 10pts total)</small>

Use Monte Carlo estimation to approximate the integral
$$\int_0^5 \frac{\sin(x^2)}{x} dx$$

a. Choose a random variable that has a support that is exactly the same as the region of integration.

b. What is the density of your random variable $f(x)$ over the support?

c. Produce an auxiliary function $h(x)=g(x)/f(x)$

d. Simulate at least 10000 random values from your distribution you chose in part a.

e. Calculate the mean of $h(X)$.




## 6. Simulating a random variable  <small>(3pts each, 6pts total)</small>

Define a random variable $X$ with density
$$
f_X(t) = \begin{cases}
      \frac12(1-\cos(x))\sin(x) &\mbox{ if } 0 \le t \le \pi \\
      0 &\mbox{ otherwise. }
      \end{cases}
$$

The probability density function (pdf) is visualized below.
```{r, fig.width=5.7, fig.height=4, echo=FALSE}
# here we define a *vectorized* function to evaluate the density of X
pdf_x = function(x) {
  # ifelse is like a function version of an if statement.
  # We use it here to ensure that pdf_x can operate directly on vectors.
  return(ifelse(0<=x & x<=pi , 1/2*(1-cos(x))*sin(x) , 0 ))
}

# showing the PDF in a plot
ggplot() + geom_function(fun=pdf_x, n=10001) + 
  coord_fixed(ratio=2) + theme_minimal() + 
  xlim(c(-.5,pi+.5)) + ylim(-.2,.7) + labs(x="x", y="f(x)")
```

This means that the cumulative distribution function is $$F_X(t)=\begin{cases}
1 & t > \pi\\
\frac14(1-\cos(t))^2 & 0 \le t \le \pi\\
0 &t < 0
\end{cases}$$

a.  Find $F^{-1}(x)$, the inverse CDF. *Hint: In `R` the `arc-cosine` function is `acos()`.*
b. Write a function `rx(n)` (like `rbinom`) to sample from this random variable, where `n` is the size of the sample to be drawn. Then, use your function to draw sample of size 1000 and plot a histogram of the output to verify the results make sense. You can do this by un-commenting the two last lines of this chunk of code.

```{r}
# complete the function
rx = function(n) {
  # TODO: code goes here
}

# The histogram should look like the PDF we plotted above.
# Un-comment the following lines of code and check it looks correct

#hist(rx(10000), probability=TRUE, breaks=25)
#lines(x=seq(0,pi,.01), y=pdf_x(seq(0,pi,.01)), col='red')
```





## 7. Conditional Average Savings (for fun!)

A commercial for Fauxgressive Auto Insurance claims "People who save with Fauxgressive save an average of \$550 dollars."

That sounds good, but notice this is a conditional average. We are only looking at the average savings of people who save more than 0 dollars!

Suppose the savings can be modeled by a normal random variable $X\sim N(0, \sigma^2)$. For example, if $x=50$ that means a customer saves \$50. If $X<0$ that indicates they would be spending *more* money on insurance with Fauxgressive.

a. Using Monte Carlo simulation, if $\sigma^2=500^2$, estimate $E(X | X>0)$

b. What would $\sigma^2$ be for $E(X | >0) \approx 550$?
